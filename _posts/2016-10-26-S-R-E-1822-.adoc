= SRE阅读笔记-18~22-容量规划
:hp-tags: SRE, capacity planing, site reliability engineering

## 传统容量规划，主要根据需求确定，人为定制
1. 收集需求预测
	需要多少资源？何时，何地需要？
	1. 根据当前使用情况规划
	2. 以季度或年度为单位
2. 设计分配计划
3. 计划review，从产品、预算、技术角度评估是否合理
4. 安装和配置资源
5. 根据变动循环流程

### 缺点
1. 传统规划比较脆弱
	可能会因为大大小小的变化导致需要重新规划。
2. 费力、低效、难以管理。

## Google的方法，基于意图的容量规划
意图，即用户希望怎样运行他们的服务。
如 我希望Foo service能够达到5个9的可靠性。
   我希望Foo service在部署时有N+2备份

### 意图主要包括哪些内容？
1. 依赖管理
   如 Foo 依赖Bar,Baz,Qux。后三者的部署方案会对直接影响Foo。
2. 性能指标
   将抽象高层的性能指标具体化，如具体需要多少计算资源等。
3. 服务优先级
   为了保证整体资源的有效利用

##  Auxon Google的容量规划和资源分配解决方案

### auxon 架构图

![auxon components](auxon_components.png)

主要包含以下内容：
1. 性能数据。 对于X服务每个单元的需求，在Y集群上需求多少单元Z依赖
2. 每个service的预测数据需求。如按大洲分的qps需求预测。
3. 资源供应。当前可获取的基础资源。如机器个数。是服务需求的计算上限。
4. 资源价格。
5. 意图配置文件。
6. 配置解析引擎。
7. Solver。解析线性方程。
8. 分配方案。 最终产出的分配方案。描述哪种资源应当分配给哪个service，及分配地址。以及哪些资源没有得到分配，以及原因。