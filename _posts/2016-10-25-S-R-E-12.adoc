

# SRE 问题定位

## 故障发生时， 先止血，再定位问题。
1. 转移流量
2. 把流量停掉，防止级联错误
3. 把一些子系统功能停掉，减轻压力
4. 保留现场，如日志等

## 检查
1. 使用监控系统记录的测量数据。
2. 使用日志。使用Dapper进行日志跟踪
3. 暴露服务当前的状态。 Google的例子如
	1. 服务最近采样的rpc接收和发送状态, 如错误率、延迟、配置、监控策略和中间计算过程。
	2. 使用封装的客户端工具。

## 诊断
1. 彻底了解系统设计
2. 分治、二分、制造测试数据。
3. 现象what, where, why. 回溯一直找到solution。
4. 最后的改动点是哪里？ 配置？负载类型？发动版本前后的错误率
5. 特定的诊断方法，解决共性需求满足不了的情况

## 测试和修复
1. 设定若干假设，制定测试方法，来确认和排除猜想。如
	1. 设定理想的测试方法，可以确认一组假设，从而把其它的都排除掉。
	2. 从最显示易见的测试方法开始。
	3. 实验可能因为一些混杂的因素，导致错误结论。如
	4. 测试方法本身也可能会对测试结果产生副作用。如通过多打日志，解决请求延迟问题。
	5. 有些测试方法可能只是必要条件，而不是充分条件。如数据竞争，死锁，很能及时复现。
	6. 记笔记，使用共享文档，避免测试case重复。
2. 测试“负”结果
	1. 可以影响系统设计。
	2. 可以了解系统服务边界
	3. 编写基础工具，用于重复利用。如压测、benchmark工具。

## 修复
1. 修复一些可能的点，做事后总结。

## 一个案例分析case study

## 使测试更简单的方法
1. 程序可视化。从项目开始时即建立白盒测量、结构化日志等。
2. 设计组件时，保持接口良好，可观。